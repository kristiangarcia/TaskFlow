<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>
<?import de.jensd.fx.glyphs.fontawesome.FontAwesomeIconView?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.taskflow.controller.MainController">

    <!-- Superior: Encabezado + Barra de herramientas -->
    <top>
        <VBox>
            <!-- Barra de encabezado oscura -->
            <VBox style="-fx-background-color: #2C3E50; -fx-padding: 15;">
                <Label text="TaskFlow" style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
            </VBox>

            <!-- Barra de herramientas clara -->
            <HBox spacing="10" style="-fx-background-color: #ECF0F1; -fx-padding: 10;">
                <Button fx:id="btnNuevoUsuario" text=" Usuario" onAction="#handleNuevoUsuario" styleClass="btn-header">
                    <graphic>
                        <FontAwesomeIconView glyphName="USER_PLUS" size="14px"/>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Crear nuevo usuario"/>
                    </tooltip>
                </Button>
                <Button fx:id="btnNuevaTarea" text=" Tarea" onAction="#handleNuevaTarea" styleClass="btn-header">
                    <graphic>
                        <FontAwesomeIconView glyphName="PLUS_CIRCLE" size="14px"/>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Crear nueva tarea"/>
                    </tooltip>
                </Button>
            </HBox>
        </VBox>
    </top>

    <!-- Centro: Panel de pestañas con 4 pestañas -->
    <center>
        <TabPane fx:id="tabPane" tabClosingPolicy="UNAVAILABLE">

            <!-- Pestaña 1: Panel de control Administrador -->
            <Tab fx:id="tabDashboardAdmin" text="Dashboard Admin" closable="false">
                <VBox spacing="20" style="-fx-padding: 20;">

                    <!-- Sección 1: Cuadrícula de métricas -->
                    <HBox spacing="20">
                        <!-- Usuarios Activos -->
                        <VBox spacing="5" style="-fx-alignment: center-left; -fx-background-color: #E0E0E0; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 250;">
                            <Label text="Usuarios Activos" style="-fx-font-size: 12px;"/>
                            <Label fx:id="lblUsuariosActivos" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold;"/>
                        </VBox>

                        <!-- Tareas Activas -->
                        <VBox spacing="5" style="-fx-alignment: center-left; -fx-background-color: #E0E0E0; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 250;">
                            <Label text="Tareas Activas" style="-fx-font-size: 12px;"/>
                            <Label fx:id="lblTareasActivas" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold;"/>
                        </VBox>

                        <!-- Tareas Completadas -->
                        <VBox spacing="5" style="-fx-alignment: center-left; -fx-background-color: #E0E0E0; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 250;">
                            <Label text="Tareas Completadas" style="-fx-font-size: 12px;"/>
                            <Label fx:id="lblTareasCompletadas" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold;"/>
                        </VBox>
                    </HBox>

                    <!-- Sección 2: Gráfico y Tabla lado a lado -->
                    <HBox spacing="20" VBox.vgrow="ALWAYS">
                        <!-- Gráfico de barras -->
                        <VBox spacing="10" style="-fx-padding: 15;" HBox.hgrow="ALWAYS">
                            <Label text="Tareas por Estado" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <BarChart fx:id="chartTareasPorEstado" legendVisible="false" VBox.vgrow="ALWAYS">
                                <xAxis>
                                    <CategoryAxis side="BOTTOM" />
                                </xAxis>
                                <yAxis>
                                    <NumberAxis side="LEFT" />
                                </yAxis>
                            </BarChart>
                        </VBox>

                        <!-- Tabla de fechas límite -->
                        <VBox spacing="10" style="-fx-padding: 15;" HBox.hgrow="ALWAYS">
                            <Label text="Próximas Fechas Límite" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <TableView fx:id="tableDeadlines" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colTituloDeadlines" text="Tarea" prefWidth="150"/>
                                    <TableColumn fx:id="colFechaLimiteDeadlines" text="Fecha Límite" prefWidth="100"/>
                                    <TableColumn fx:id="colPrioridadDeadlines" text="Prioridad" prefWidth="80"/>
                                    <TableColumn fx:id="colEstadoDeadlines" text="Estado" prefWidth="100"/>
                                </columns>
                            </TableView>
                        </VBox>
                    </HBox>

                    <!-- Sección 3: Botones de Informes -->
                    <VBox spacing="10">
                        <Label text="Informes" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        <HBox spacing="15">
                            <Button fx:id="btnInformeTareasGrafica" text=" Informe de Tareas con Gráfica (Incrustado)"
                                    onAction="#handleInformeTareasGrafica" styleClass="btn-primary">
                                <graphic>
                                    <FontAwesomeIconView glyphName="BAR_CHART" size="14px"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Generar informe de tareas con gráfica"/>
                                </tooltip>
                            </Button>

                            <ComboBox fx:id="comboEstadoFiltro" promptText="Filtrar por estado" prefWidth="150">
                            </ComboBox>

                            <Button fx:id="btnInformeAsignaciones" text=" Informe de Asignaciones (Ventana Nueva)"
                                    onAction="#handleInformeAsignaciones" styleClass="btn-assign">
                                <graphic>
                                    <FontAwesomeIconView glyphName="FILE_TEXT_ALT" size="14px"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Generar informe de asignaciones en ventana nueva"/>
                                </tooltip>
                            </Button>
                        </HBox>
                    </VBox>

                    <!-- Sección 4: WebView para mostrar informe incrustado -->
                    <VBox spacing="10" VBox.vgrow="ALWAYS" style="-fx-border-color: #3498DB; -fx-border-width: 2; -fx-border-radius: 5; -fx-padding: 10;">
                        <Label text="Vista de Informe" style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: #3498DB;"/>
                        <javafx.scene.web.WebView fx:id="webViewInforme" VBox.vgrow="ALWAYS" prefHeight="400"/>
                    </VBox>

                </VBox>
            </Tab>

            <!-- Pestaña 2: Gestión de Usuarios -->
            <Tab fx:id="tabGestionUsuarios" text="Gestión Usuarios" closable="false">
                <VBox spacing="15" style="-fx-padding: 20;">

                    <!-- Barra de herramientas HBox -->
                    <HBox spacing="10" style="-fx-alignment: center-left;">
                        <Button fx:id="btnNuevoUsuarioTab" text="Nuevo Usuario">
                            <tooltip>
                                <Tooltip text="Crear nuevo usuario"/>
                            </tooltip>
                        </Button>
                        <Button fx:id="btnExportarUsuarios" text="Exportar CSV">
                            <tooltip>
                                <Tooltip text="Exportar usuarios a archivo CSV"/>
                            </tooltip>
                        </Button>
                        <Button fx:id="btnImportarUsuarios" text="Importar CSV">
                            <tooltip>
                                <Tooltip text="Importar usuarios desde archivo CSV"/>
                            </tooltip>
                        </Button>
                        <Separator prefHeight="25"/>
                        <TextField fx:id="txtBuscarUsuarios" promptText="Buscar por nombre..." prefWidth="200"/>
                        <ComboBox fx:id="comboFiltroRol" promptText="Filtrar por rol" prefWidth="150"/>
                        <CheckBox fx:id="checkSoloActivos" text="Solo activos"/>
                    </HBox>

                    <!-- Vista de tabla -->
                    <TableView fx:id="tableUsuarios" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colIdUsuarios" text="ID" prefWidth="50"/>
                            <TableColumn fx:id="colNombreUsuarios" text="Nombre" prefWidth="150"/>
                            <TableColumn fx:id="colEmailUsuarios" text="Email" prefWidth="200"/>
                            <TableColumn fx:id="colTelefonoUsuarios" text="Teléfono" prefWidth="120"/>
                            <TableColumn fx:id="colRolUsuarios" text="Rol" prefWidth="100"/>
                            <TableColumn fx:id="colActivoUsuarios" text="Activo" prefWidth="80"/>
                            <TableColumn fx:id="colAccionesUsuarios" text="Acciones" prefWidth="150"/>
                        </columns>
                    </TableView>

                    <!-- Etiqueta de paginación -->
                    <Label fx:id="lblPaginacion" text="Página 1 de 1" style="-fx-font-size: 12px;"/>

                </VBox>
            </Tab>

            <!-- Pestaña 3: Gestión de Tareas -->
            <Tab fx:id="tabGestionTareas" text="Gestión Tareas" closable="false">
                <VBox spacing="15" style="-fx-padding: 20;">

                    <!-- Barra de herramientas HBox -->
                    <HBox spacing="10" style="-fx-alignment: center-left;">
                        <Button fx:id="btnNuevaTareaTab" text="Nueva Tarea">
                            <tooltip>
                                <Tooltip text="Crear nueva tarea"/>
                            </tooltip>
                        </Button>
                        <Button fx:id="btnExportarTareas" text="Exportar CSV">
                            <tooltip>
                                <Tooltip text="Exportar tareas a archivo CSV"/>
                            </tooltip>
                        </Button>
                        <Button fx:id="btnImportarTareas" text="Importar CSV">
                            <tooltip>
                                <Tooltip text="Importar tareas desde archivo CSV"/>
                            </tooltip>
                        </Button>
                        <Separator prefHeight="25"/>
                        <TextField fx:id="txtBuscarTareas" promptText="Buscar por título..." prefWidth="200"/>
                        <ComboBox fx:id="comboEstado" promptText="Estado" prefWidth="150"/>
                        <ComboBox fx:id="comboPrioridad" promptText="Prioridad" prefWidth="150"/>
                        <ComboBox fx:id="comboCategoria" promptText="Categoría" prefWidth="150"/>
                    </HBox>

                    <!-- Vista de tabla -->
                    <TableView fx:id="tableTareas" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colIdTareas" text="ID" prefWidth="50"/>
                            <TableColumn fx:id="colTituloTareas" text="Título" prefWidth="200"/>
                            <TableColumn fx:id="colCategoriaTareas" text="Categoría" prefWidth="150"/>
                            <TableColumn fx:id="colPrioridadTareas" text="Prioridad" prefWidth="100"/>
                            <TableColumn fx:id="colTiempoEstimadoTareas" text="Tiempo (mins)" prefWidth="100"/>
                            <TableColumn fx:id="colEstadoTareas" text="Estado" prefWidth="120"/>
                            <TableColumn fx:id="colAsignadosTareas" text="Asignados" prefWidth="100"/>
                            <TableColumn fx:id="colAccionesTareas" text="Acciones" prefWidth="120"/>
                        </columns>
                    </TableView>

                </VBox>
            </Tab>

            <!-- Pestaña 4: Panel de control Empleado -->
            <Tab fx:id="tabDashboardEmpleado" text="Dashboard Empleado" closable="false">
                <ScrollPane fitToWidth="true" fitToHeight="true">
                <VBox spacing="20" style="-fx-padding: 20;">

                    <!-- Saludo personalizado -->
                    <VBox spacing="5">
                        <Label fx:id="lblSaludo" text="Hola, Usuario" style="-fx-font-size: 24px; -fx-font-weight: bold;"/>
                        <Label text="Aquí está tu resumen de productividad de hoy" style="-fx-font-size: 12px; -fx-text-fill: #666;"/>
                    </VBox>

                    <!-- Sección 1: Métricas personales -->
                    <HBox spacing="20">
                        <!-- Mis Tareas -->
                        <VBox spacing="5" style="-fx-alignment: center-left; -fx-background-color: #E0E0E0; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 200;">
                            <Label text="Mis Tareas" style="-fx-font-size: 12px;"/>
                            <Label fx:id="lblMisTareas" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold;"/>
                        </VBox>

                        <!-- En Progreso -->
                        <VBox spacing="5" style="-fx-alignment: center-left; -fx-background-color: #E0E0E0; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 200;">
                            <Label text="En Progreso" style="-fx-font-size: 12px;"/>
                            <Label fx:id="lblEnProgreso" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold;"/>
                        </VBox>

                        <!-- Completadas Hoy -->
                        <VBox spacing="5" style="-fx-alignment: center-left; -fx-background-color: #E0E0E0; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 200;">
                            <Label text="Completadas Hoy" style="-fx-font-size: 12px;"/>
                            <Label fx:id="lblCompletadasHoy" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold;"/>
                        </VBox>

                        <!-- Tiempo Total Hoy -->
                        <VBox spacing="5" style="-fx-alignment: center-left; -fx-background-color: #E0E0E0; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 200;">
                            <Label text="Tiempo Total Hoy" style="-fx-font-size: 12px;"/>
                            <Label fx:id="lblTiempoTotal" text="0h" style="-fx-font-size: 36px; -fx-font-weight: bold;"/>
                        </VBox>
                    </HBox>

                    <!-- Sección 2: Modo Focus y Mis Tareas Pendientes lado a lado -->
                    <HBox spacing="20" prefHeight="400">
                        <!-- Modo Focus -->
                        <VBox spacing="10" style="-fx-background-color: #5cb85c; -fx-padding: 20; -fx-background-radius: 5;" HBox.hgrow="ALWAYS">
                            <Label text="Modo Focus - Próxima Tarea Sugerida" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>

                            <Label fx:id="lblTareaFoco" text="Sin tarea seleccionada" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: white;"/>

                            <HBox spacing="40">
                                <VBox spacing="5">
                                    <Label text="Categoría" style="-fx-font-size: 10px; -fx-text-fill: white;"/>
                                    <Label fx:id="lblCategoriaFoco" text="--" style="-fx-font-size: 12px; -fx-text-fill: white;"/>
                                </VBox>
                                <VBox spacing="5">
                                    <Label text="Prioridad" style="-fx-font-size: 10px; -fx-text-fill: white;"/>
                                    <Label fx:id="lblPrioridadFoco" text="--" style="-fx-font-size: 12px; -fx-text-fill: white;"/>
                                </VBox>
                            </HBox>
                            <HBox spacing="40">
                                <VBox spacing="5">
                                    <Label text="Tiempo Estimado" style="-fx-font-size: 10px; -fx-text-fill: white;"/>
                                    <Label fx:id="lblTiempoEstimadoFoco" text="--" style="-fx-font-size: 12px; -fx-text-fill: white;"/>
                                </VBox>
                                <VBox spacing="5">
                                    <Label text="Fecha Límite" style="-fx-font-size: 10px; -fx-text-fill: white;"/>
                                    <Label fx:id="lblFechaLimiteFoco" text="--" style="-fx-font-size: 12px; -fx-text-fill: white;"/>
                                </VBox>
                            </HBox>

                            <Label fx:id="lblPrediccionIA" text="Predicción IA: Esta tarea podría retrasarse. Se recomienda iniciar pronto."
                                   style="-fx-font-size: 11px; -fx-text-fill: white; -fx-background-color: rgba(0,0,0,0.2); -fx-padding: 10; -fx-background-radius: 3;"/>

                            <Button fx:id="btnIniciarFoco" text="Iniciar Timer" style="-fx-font-size: 14px; -fx-pref-height: 40;">
                                <tooltip>
                                    <Tooltip text="Iniciar temporizador para la tarea actual"/>
                                </tooltip>
                            </Button>
                        </VBox>

                        <!-- Mis Tareas Pendientes -->
                        <VBox spacing="10" HBox.hgrow="ALWAYS">
                            <Label text="Mis Tareas Pendientes" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                            <TableView fx:id="tableMisTareas" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="colTituloMisTareas" text="Título" prefWidth="250"/>
                                <TableColumn fx:id="colPrioridadMisTareas" text="Prioridad" prefWidth="100"/>
                                <TableColumn fx:id="colFechaLimiteMisTareas" text="Fecha Límite" prefWidth="120"/>
                                <TableColumn fx:id="colAccionMisTareas" text="Acción" prefWidth="100"/>
                            </columns>
                            <placeholder>
                                <Label text="No hay tareas pendientes" style="-fx-text-fill: #666;"/>
                            </placeholder>
                        </TableView>
                        </VBox>
                    </HBox>

                    <!-- Sección 3: Gráfico de Progreso Semanal -->
                    <VBox spacing="10" style="-fx-padding: 15;">
                        <Label text="Mi Progreso Esta Semana" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                        <Label text="Tareas completadas por día" style="-fx-font-size: 11px; -fx-text-fill: #666;"/>
                        <BarChart fx:id="chartProgresoSemanal" legendVisible="false" prefHeight="200">
                            <xAxis>
                                <CategoryAxis side="BOTTOM" />
                            </xAxis>
                            <yAxis>
                                <NumberAxis side="LEFT" />
                            </yAxis>
                        </BarChart>
                    </VBox>

                </VBox>
                </ScrollPane>
            </Tab>

        </TabPane>
    </center>

</BorderPane>
